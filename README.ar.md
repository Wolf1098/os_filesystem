# os_filesystem- نظام ملفات افتراضي (C ++)

## مقدمة

هذا هو نظام ملفات ظاهري يشبه لينكس ، ويتم حمل النظام بواسطة ملف قرص افتراضي ، والذي يحاكي قراءة القرص وكتابته عن طريق قراءة الملف وكتابته ، ولا يتضمن برامج تشغيل أساسية.

لكتابة نظام ملفات بسيط يشبه Linux ، تحتاج أولاً إلى تصميم إطار عمل أساسي يتضمن inode و block و superblock وتخطيط القرص الافتراضي وتخصيص المساحة ومعلومات أخرى. بداية نظام الملفات هو superblock ، والذي يحتوي على معلومات مهمة حول النظام ، بما في ذلك عدد وحجم inodes والكتل. بالنسبة إلى inode ، بشكل عام ، يحتاج إلى شغل واحد بالمائة من مساحة القرص ، ولكن هذا نظام صغير بحجم إجمالي يزيد قليلاً عن 5M ، وبالتالي فإن المساحة المخصصة لمنطقة inode صغيرة جدًا ، ومعظمها المساحة المتبقية هي منطقة الكتلة.

الخطة الشاملة لنظام الملفات هي كما يلي:  
![](./screenshots/00.png)

نظرًا لضيق الوقت عند كتابة البرنامج ، فقد استغرق الأمر 4 أيام فقط للتحقق من الشفرة وقبولها ، لذلك لم يكن لدى الكود وقت للتحسين ، وستبدو بعض الأجزاء زائدة عن الحاجة. لا تتفاجأ.

على الرغم من أن الوقت محدود ، إلا أنه يقوم أيضًا بتنفيذ وظيفة محرر vi. الكتابة بسيطة نسبيًا والشفرة فوضوية ، وهناك وقت لتحسينها.

بشكل عام ، لم يتم تحسين الكود بعد ، ونرحب بالمزيد من التعليقات ، ويتم اختيار المزيد من الأخطاء.

## كيف تستعمل

### الخطوة 1: قم بتنزيل المشروع

`git clone https://github.com/windcode/os_filesystem.git`

### الخطوة 2: افتح المشروع باستخدام VC ++ 6.0

انقر نقرًا مزدوجًا في الكتالوج**MingOS.dsw**ملف أو اسحب الملف إلى واجهة VC ++ 6.0.

### الخطوة 3: ترجمة ، ربط ، تشغيل

![](./screenshots/0.png)

### أو

### الخطوة 1: تشغيل مباشرة**/ تصحيح**تحت المجلد**MingOS.exe**وثيقة

## صفة مميزة

-   أول تشغيل ، قم بإنشاء ملف قرص افتراضي

![](./screenshots/1.png)

-   نظام تسجيل الدخول

المستخدم الافتراضي هو الجذر وكلمة المرور هي الجذر

![](./screenshots/2.gif)

-   أمر المساعدة (مساعدة)

![](./screenshots/3.gif)

-   إضافة المستخدم ، حذف ، تسجيل الدخول ، تسجيل الخروج (إضافة مستخدم ، مستخدم ، تسجيل الخروج)

![](./screenshots/5.gif)

-   تعديل أذونات الملف أو الدليل (chmod)

![](./screenshots/6.gif)

-   الكتابة والقراءة مقيدة بالأذونات

![](./screenshots/7.gif)

-   文件/文件夹添加、删除（touch、rm、mkdir、rmdir）

![](./screenshots/8.gif)

-   عرض معلومات النظام (Super ، inode ، block)

![](./screenshots/9.gif)

-   تقليد محرر نصوص vi (السادس)

![](./screenshots/4.gif)

-   معلومات الدليل وملف إدارة عقدة الفهرس

-   استعمال**طريقة ارتباط المجموعة**إدارة تخصيص الكتل المجانية
        * **block分配过程：**
    عندما يلزم تخصيص كتلة ، فإن الجزء العلوي من مكدس الكتلة الحرة يأخذ عنوان كتلة مجاني باعتباره الكتلة المخصصة حديثًا.
    عندما يكون المكدس فارغًا ، يتم استخدام المكدس في الكتلة الحرة التي يمثلها العنوان السفلي للمكدس باعتباره مكدس الكتلة الحرة الجديد.
        * **block回收过程：**
    عند استعادة كتلة ، تحقق مما إذا كانت المكدس ممتلئة.إذا لم تكن ممتلئة ، يتم تحريك مؤشر المكدس الحالي لأعلى ويتم وضع عنوان الكتلة المراد استعادتها أعلى المكدس الجديد.
    إذا كان المكدس ممتلئًا ، فسيتم استخدام الكتلة المراد إعادة تدويرها كمكدس كتل مجاني جديد ، ويتم تعيين عنوان العنصر السفلي من مكدس الكتلة الحرة على مكدس الكتلة المجاني الآن.
        * 分配和回收的同时需要更新block位图，以及超级块。

-   تخصيص / استصلاح inode
    -   يعد تخصيص واستعادة inodes بسيطًا نسبيًا ، باستخدام التخصيص والاسترداد التسلسلي.
    -   عندما تحتاج إلى تخصيص ، ابحث عن inode مجاني بالتسلسل من الصورة النقطية inode ، وأعد رقم inode إذا نجح البحث.
    -   عند إعادة التدوير ، ما عليك سوى تحديث الصورة النقطية في inode.
    -   يحتاج كل من التخصيص والاسترداد إلى تحديث الصورة النقطية في inode.

## يلاحظ

-   بيئة التشغيل هي VC ++ 6.0
